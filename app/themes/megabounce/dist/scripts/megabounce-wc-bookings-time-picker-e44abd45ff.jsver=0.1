jQuery(document).ready(function(e){function a(a,n){var t=a.closest("form").find(".wc-bookings-booking-form-button");if(void 0===n)return void t.addClass("disabled");var s=a.find('[data-value="'+n+'"]');if(void 0===s.data("value"))return void t.addClass("disabled");var i=a.closest("div").find("input");i.val(n).change(),a.closest("ul").find("a").removeClass("selected"),s.addClass("selected"),t.removeClass("disabled");var r=e('input[name="add-to-cart"]').val();o(r,n)}function o(a,o){var n=e(".fake-cart .product-name");s&&s.abort(),s=e.ajax({type:"POST",url:booking_form_params.ajax_url,cache:!1,data:{action:"megabounce_wc_bookings_get_fake_cart",product_id:a,date:r,time:o},success:function(a){n.html(a),e(document).trigger("goToStep","person-count")},dataType:"html"})}function n(o){var n=e(o).closest("form"),s=e(o).closest("div").find("fieldset"),c=e(o).closest("div").find(".block-picker"),l=c.find(".selected"),d=parseInt(s.find("input.booking_date_year").val(),10),_=parseInt(s.find("input.booking_date_month").val(),10),p=parseInt(s.find("input.booking_date_day").val(),10);d&&_&&p&&(r=Date.UTC(d,_-1,p)/1e3,c.closest("div").find("input").val("").change(),c.closest("div").block({message:null,overlayCSS:{background:"#fff",backgroundSize:"16px 16px",opacity:.6}}).show(),i&&i.abort(),i=e.ajax({type:"POST",cache:!1,url:booking_form_params.ajax_url,data:{action:"megabounce_wc_bookings_get_blocks",form:n.serialize()},success:function(e){c.html(e),c.closest("div").unblock(),a(c,l.data("value")),t()},dataType:"html"}))}function t(){if(console.log("init cal snap"),Foundation.MediaQuery.atLeast("large")){Waypoint.destroyAll(),e(window).trigger("resize");var a=e(".block-picker").eq(0),o=e(".cta.cta-reservation-help").eq(0);new Waypoint({element:a,handler:function(a){"down"===a?e(".wc-bookings-date-picker").eq(0).addClass("is-snapped"):"up"===a&&e(".wc-bookings-date-picker").eq(0).removeClass("is-snapped")},offset:"180px"}),new Waypoint({element:o,handler:function(a){"down"===a?e(".wc-bookings-date-picker").eq(0).removeClass("is-snapped").addClass("is-sticky"):"up"===a&&e(".wc-bookings-date-picker").eq(0).removeClass("is-sticky").addClass("is-snapped")},offset:"620px"})}}e.ajaxSetup({cache:!1});var s,i,r,c=0,l=!0;e(".block-picker").on("click","a",function(o){if(!l){var n=e(this).data("value"),t=e(this).closest("ul");return a(t,n),l=!0,!1}o.preventDefault();var s=e(this).data("product");e('input[name="add-to-cart"]').val(s),c=parseInt(e(this).data("max-persons")),e("input.wc_bookings_field_persons").attr("max",c),l=!1,e(this).click()});var d=!1,_=!1;e("form.cart").on("change scroll","input.wc_bookings_field_persons",function(a){if(!d){d=!0;var o=parseInt(e('input[name="wc_bookings_field_persons_min_18"]').val()),n=parseInt(e('input[name="wc_bookings_field_persons_plus_18"]').val()),t=o+n,s=o,i=n;t>=c?"wc_bookings_field_persons_min_18"==e(this).attr("name")?(s=o,i=c-o):"wc_bookings_field_persons_plus_18"==e(this).attr("name")&&(s=c-n,i=n):0==t&&("wc_bookings_field_persons_min_18"==e(this).attr("name")?(s=0,i=1):"wc_bookings_field_persons_plus_18"==e(this).attr("name")&&(s=1,i=0)),s=s<0?0:s,i=i<0?0:i;var r=s+i;r=0==r?1:r,e('input[name="wc_bookings_field_persons"]').val(r).change(),e('input[name="wc_bookings_field_persons_min_18"]').val(s).change(),e('input[name="wc_bookings_field_persons_plus_18"]').val(i).change(),e("form.cart").trigger("update"),d=!1}}).on("submit",function(a){if(!_){_=!0,a.preventDefault(),e(".woocommerce-error").remove();var o=e("form.cart"),n={min_18:e('input[name="wc_bookings_field_persons_min_18"]').val(),plus_18:e('input[name="wc_bookings_field_persons_plus_18"]').val()};e.ajax({type:"POST",dataType:"json",url:booking_form_params.ajax_url,cache:!1,data:{action:"megabounce_wc_bookings_set_person_count",person_count:n},success:function(a,n,t){if("SUCCES"!==a.result){var s='<ul class="woocommerce-error"><li>'+a.message+"</li></ul>";e("#content").prepend(s),o.find('button[type="submit"]').removeClass("disabled"),_=!1,e("html, body").animate({scrollTop:0},1100)}else o.submit()},error:function(e,a,n){o.find('button[type="submit"]').removeClass("disabled"),_=!1}}),e(this).find('button[type="submit"]').addClass("disabled")}}),e("#prev-step-button").on("click",function(){e(".block-picker a").removeClass("selected"),e('input[name="wc_bookings_field_start_date_time"]').val("").change(),e(document).trigger("goToStep","day-time")}),e("#wc_bookings_field_resource, #wc_bookings_field_duration").change(function(){n(this)}),e(".wc-bookings-booking-form fieldset").on("date-selected",function(){n(this)})});